/******************************************
LPSOLVE tsptw4.lp ----JAPeTo----
<jeffersonamado@gmail.com>
*******************************************/

/**Objective funtion**/
min: 6 x12 + 9 x13 +3 x14 +4 x15 + 9 x21 +12 x23 + 7 x24 + 6 x25 +10 x31 
      +10 x32 +5 x34 +8 x35 +8 x41 + 9 x42 +9 x43 +10 x45 + 5 x51 +4 x52
      +8 x53+6 x54 + 1 xP1+ 1 xP2 + 1 xP3 + 1 xP4+ 1 xP5 + 1 x1Q+ + 1 x2Q + 1 x3Q + 1 x4Q +1 x5Q;

/*input Para garantizar que se sale de cada ciudad exactamente una vez:*/
x12 + x13 + x14 + x15 + x1Q =1;
x23 + x24 + x25 + x21 + x2Q =1;
x31 + x32 + x34 + x35 + x3Q =1;
x41 + x42 + x43 + x45 + x4Q =1;
x51 + x52 + x53 + x54 + x5Q =1;

xP1 + xP2 + xP3 + xP4 + xP5 =1;

/*output Para garantizar que se llega a cada ciudad exactamente una vez:*/
x21 + x31 + x41 + x51 + xP1 =1;
x32 + x42 + x52 + x12 + xP2 =1;
x13 + x23 + x43 + x53 + xP3 =1;
x14 + x24 + x34 + x54 + xP4 =1;
x15 + x25 + x35 + x45 + xP5 =1;

x1Q + x2Q + x3Q + x4Q + x5Q =1;

/*Para evitar los ciclos desde los mas sencillos hasta los mas complejos*/
x12+x21<=1;
x13+x31<=1;
x14+x41<=1;
x15+x51<=1;
x21+x12<=1;
x23+x32<=1;
x24+x42<=1;
x25+x52<=1;
x31+x13<=1;
x32+x23<=1;
x34+x43<=1;
x35+x53<=1;
x41+x14<=1;
x42+x24<=1;
x43+x34<=1;
x45+x54<=1;
x51+x15<=1;
x52+x25<=1;
x53+x35<=1;
x54+x45<=1;
x12+x2Q<=2;
x13+x3Q<=2;
x14+x4Q<=2;
x15+x5Q<=2;
x21+x1Q<=2;
x23+x3Q<=2;
x24+x4Q<=2;
x25+x5Q<=2;
x31+x1Q<=2;
x32+x2Q<=2;
x34+x4Q<=2;
x35+x5Q<=2;
x41+x1Q<=2;
x42+x2Q<=2;
x43+x3Q<=2;
x45+x5Q<=2;
x51+x1Q<=2;
x52+x2Q<=2;
x53+x3Q<=2;
x54+x4Q<=2;
x12+x23+x31<=2;
x13+x32+x21<=2;
x12+x24+x41<=2;
x14+x42+x21<=2;
x15+x52+x21<=2;
x12+x25+x51<=2;
x13+x35+x51<=2;
x15+x53+x31<=2;
x15+x54+x41<=2;
x14+x45+x51<=2;
x14+x43+x31<=2;
x13+x34+x41<=2;
x21+x13+x32<=2;
x23+x31+x12<=2;
x24+x41+x12<=2;
x21+x14+x42<=2;
x25+x51+x12<=2;
x21+x15+x52<=2;
x24+x43+x32<=2;
x23+x34+x42<=2;
x24+x45+x52<=2;
x25+x54+x42<=2;
x23+x35+x52<=2;
x25+x53+x32<=2;
x31+x12+x23<=2;
x32+x21+x13<=2;
x34+x41+x13<=2;
x31+x14+x43<=2;
x35+x51+x13<=2;
x31+x15+x53<=2;
x34+x42+x23<=2;
x32+x24+x43<=2;
x35+x52+x23<=2;
x32+x25+x53<=2;
x35+x54+x43<=2;
x34+x45+x53<=2;
x41+x12+x24<=2;
x42+x21+x14<=2;
x41+x13+x34<=2;
x43+x31+x14<=2;
x45+x51+x14<=2;
x41+x15+x54<=2;
x42+x23+x34<=2;
x43+x32+x24<=2;
x45+x52+x24<=2;
x42+x25+x54<=2;
x45+x53+x34<=2;
x43+x35+x54<=2;
x51+x12+x25<=2;
x52+x21+x15<=2;
x53+x31+x15<=2;
x51+x13+x35<=2;
x54+x41+x15<=2;
x51+x14+x45<=2;
x52+x23+x35<=2;
x53+x32+x25<=2;
x52+x24+x45<=2;
x54+x42+x25<=2;
x54+x43+x35<=2;
x53+x34+x45<=2;
x12+x23+x3Q<=3;
x13+x32+x2Q<=3;
x12+x24+x4Q<=3;
x14+x42+x2Q<=3;
x15+x52+x2Q<=3;
x12+x25+x5Q<=3;
x13+x35+x5Q<=3;
x15+x53+x3Q<=3;
x15+x54+x4Q<=3;
x14+x45+x5Q<=3;
x14+x43+x3Q<=3;
x13+x34+x4Q<=3;
x21+x13+x3Q<=3;
x23+x31+x1Q<=3;
x24+x41+x1Q<=3;
x21+x14+x4Q<=3;
x25+x51+x1Q<=3;
x21+x15+x5Q<=3;
x24+x43+x3Q<=3;
x23+x34+x4Q<=3;
x24+x45+x5Q<=3;
x25+x54+x4Q<=3;
x23+x35+x5Q<=3;
x25+x53+x3Q<=3;
x31+x12+x2Q<=3;
x32+x21+x1Q<=3;
x34+x41+x1Q<=3;
x31+x14+x4Q<=3;
x35+x51+x1Q<=3;
x31+x15+x5Q<=3;
x34+x42+x2Q<=3;
x32+x24+x4Q<=3;
x35+x52+x2Q<=3;
x32+x25+x5Q<=3;
x35+x54+x4Q<=3;
x34+x45+x5Q<=3;
x41+x12+x2Q<=3;
x42+x21+x1Q<=3;
x41+x13+x3Q<=3;
x43+x31+x1Q<=3;
x45+x51+x1Q<=3;
x41+x15+x5Q<=3;
x42+x23+x3Q<=3;
x43+x32+x2Q<=3;
x45+x52+x2Q<=3;
x42+x25+x5Q<=3;
x45+x53+x3Q<=3;
x43+x35+x5Q<=3;
x51+x12+x2Q<=3;
x52+x21+x1Q<=3;
x53+x31+x1Q<=3;
x51+x13+x3Q<=3;
x54+x41+x1Q<=3;
x51+x14+x4Q<=3;
x52+x23+x3Q<=3;
x53+x32+x2Q<=3;
x52+x24+x4Q<=3;
x54+x42+x2Q<=3;
x54+x43+x3Q<=3;
x53+x34+x4Q<=3;
x12+x23+x34+x41<=4;
x13+x32+x24+x41<=4;
x12+x24+x43+x31<=4;
x14+x42+x23+x31<=4;
x13+x34+x42+x21<=4;
x14+x43+x32+x21<=4;
x15+x54+x43+x31<=4;
x14+x45+x53+x31<=4;
x15+x53+x34+x41<=4;
x13+x35+x54+x41<=4;
x14+x43+x35+x51<=4;
x13+x34+x45+x51<=4;
x12+x25+x53+x31<=4;
x15+x52+x23+x31<=4;
x12+x23+x35+x51<=4;
x13+x32+x25+x51<=4;
x13+x35+x52+x21<=4;
x15+x53+x32+x21<=4;
x14+x42+x25+x51<=4;
x12+x24+x45+x51<=4;
x14+x45+x52+x21<=4;
x15+x54+x42+x21<=4;
x12+x25+x54+x41<=4;
x15+x52+x24+x41<=4;
x21+x13+x34+x42<=4;
x23+x31+x14+x42<=4;
x21+x14+x43+x32<=4;
x24+x41+x13+x32<=4;
x23+x34+x41+x12<=4;
x24+x43+x31+x12<=4;
x25+x54+x43+x32<=4;
x24+x45+x53+x32<=4;
x25+x53+x34+x42<=4;
x23+x35+x54+x42<=4;
x23+x34+x45+x52<=4;
x24+x43+x35+x52<=4;
x25+x53+x31+x12<=4;
x23+x35+x51+x12<=4;
x25+x51+x13+x32<=4;
x21+x15+x53+x32<=4;
x23+x31+x15+x52<=4;
x21+x13+x35+x52<=4;
x24+x41+x15+x52<=4;
x21+x14+x45+x52<=4;
x24+x45+x51+x12<=4;
x25+x54+x41+x12<=4;
x25+x51+x14+x42<=4;
x21+x15+x54+x42<=4;
x34+x45+x51+x13<=4;
x35+x54+x41+x13<=4;
x34+x41+x15+x53<=4;
x31+x14+x45+x53<=4;
x31+x15+x54+x43<=4;
x35+x51+x14+x43<=4;
x32+x21+x15+x53<=4;
x31+x12+x25+x53<=4;
x32+x25+x51+x13<=4;
x35+x52+x21+x13<=4;
x31+x15+x52+x23<=4;
x35+x51+x12+x23<=4;
x34+x42+x25+x53<=4;
x32+x24+x45+x53<=4;
x34+x45+x52+x23<=4;
x35+x54+x42+x23<=4;
x35+x52+x24+x43<=4;
x32+x25+x54+x43<=4;
x34+x41+x12+x23<=4;
x31+x14+x42+x23<=4;
x34+x42+x21+x13<=4;
x32+x24+x41+x13<=4;
x31+x12+x24+x43<=4;
x32+x21+x14+x43<=4;
x45+x51+x12+x24<=4;
x41+x15+x52+x24<=4;
x45+x52+x21+x14<=4;
x42+x25+x51+x14<=4;
x41+x12+x25+x54<=4;
x42+x21+x15+x54<=4;
x41+x12+x23+x34<=4;
x42+x21+x13+x34<=4;
x41+x13+x32+x24<=4;
x43+x31+x12+x24<=4;
x42+x23+x31+x14<=4;
x43+x32+x21+x14<=4;
x45+x52+x23+x34<=4;
x42+x25+x53+x34<=4;
x45+x53+x32+x24<=4;
x43+x35+x52+x24<=4;
x43+x32+x25+x54<=4;
x42+x23+x35+x54<=4;
x43+x31+x15+x54<=4;
x41+x13+x35+x54<=4;
x43+x35+x51+x14<=4;
x45+x53+x31+x14<=4;
x45+x51+x13+x34<=4;
x41+x15+x53+x34<=4;
x51+x12+x23+x35<=4;
x52+x21+x13+x35<=4;
x51+x13+x32+x25<=4;
x53+x31+x12+x25<=4;
x52+x23+x31+x15<=4;
x53+x32+x21+x15<=4;
x52+x23+x34+x45<=4;
x53+x32+x24+x45<=4;
x52+x24+x43+x35<=4;
x54+x42+x23+x35<=4;
x53+x34+x42+x25<=4;
x54+x43+x32+x25<=4;
x53+x31+x14+x45<=4;
x51+x13+x34+x45<=4;
x53+x34+x41+x15<=4;
x54+x43+x31+x15<=4;
x51+x14+x43+x35<=4;
x54+x41+x13+x35<=4;
x54+x41+x12+x25<=4;
x51+x14+x42+x25<=4;
x54+x42+x21+x15<=4;
x52+x24+x41+x15<=4;
x52+x21+x14+x45<=4;
x51+x12+x24+x45<=4;
x12+x23+x34+x4Q<=5;
x13+x32+x24+x4Q<=5;
x12+x24+x43+x3Q<=5;
x14+x42+x23+x3Q<=5;
x13+x34+x42+x2Q<=5;
x14+x43+x32+x2Q<=5;
x15+x54+x43+x3Q<=5;
x14+x45+x53+x3Q<=5;
x15+x53+x34+x4Q<=5;
x13+x35+x54+x4Q<=5;
x14+x43+x35+x5Q<=5;
x13+x34+x45+x5Q<=5;
x12+x25+x53+x3Q<=5;
x15+x52+x23+x3Q<=5;
x12+x23+x35+x5Q<=5;
x13+x32+x25+x5Q<=5;
x13+x35+x52+x2Q<=5;
x15+x53+x32+x2Q<=5;
x14+x42+x25+x5Q<=5;
x12+x24+x45+x5Q<=5;
x14+x45+x52+x2Q<=5;
x15+x54+x42+x2Q<=5;
x12+x25+x54+x4Q<=5;
x15+x52+x24+x4Q<=5;
x21+x13+x34+x4Q<=5;
x23+x31+x14+x4Q<=5;
x21+x14+x43+x3Q<=5;
x24+x41+x13+x3Q<=5;
x23+x34+x41+x1Q<=5;
x24+x43+x31+x1Q<=5;
x25+x54+x43+x3Q<=5;
x24+x45+x53+x3Q<=5;
x25+x53+x34+x4Q<=5;
x23+x35+x54+x4Q<=5;
x23+x34+x45+x5Q<=5;
x24+x43+x35+x5Q<=5;
x25+x53+x31+x1Q<=5;
x23+x35+x51+x1Q<=5;
x25+x51+x13+x3Q<=5;
x21+x15+x53+x3Q<=5;
x23+x31+x15+x5Q<=5;
x21+x13+x35+x5Q<=5;
x24+x41+x15+x5Q<=5;
x21+x14+x45+x5Q<=5;
x24+x45+x51+x1Q<=5;
x25+x54+x41+x1Q<=5;
x25+x51+x14+x4Q<=5;
x21+x15+x54+x4Q<=5;
x34+x45+x51+x1Q<=5;
x35+x54+x41+x1Q<=5;
x34+x41+x15+x5Q<=5;
x31+x14+x45+x5Q<=5;
x31+x15+x54+x4Q<=5;
x35+x51+x14+x4Q<=5;
x32+x21+x15+x5Q<=5;
x31+x12+x25+x5Q<=5;
x32+x25+x51+x1Q<=5;
x35+x52+x21+x1Q<=5;
x31+x15+x52+x2Q<=5;
x35+x51+x12+x2Q<=5;
x34+x42+x25+x5Q<=5;
x32+x24+x45+x5Q<=5;
x34+x45+x52+x2Q<=5;
x35+x54+x42+x2Q<=5;
x35+x52+x24+x4Q<=5;
x32+x25+x54+x4Q<=5;
x34+x41+x12+x2Q<=5;
x31+x14+x42+x2Q<=5;
x34+x42+x21+x1Q<=5;
x32+x24+x41+x1Q<=5;
x31+x12+x24+x4Q<=5;
x32+x21+x14+x4Q<=5;
x45+x51+x12+x2Q<=5;
x41+x15+x52+x2Q<=5;
x45+x52+x21+x1Q<=5;
x42+x25+x51+x1Q<=5;
x41+x12+x25+x5Q<=5;
x42+x21+x15+x5Q<=5;
x41+x12+x23+x3Q<=5;
x42+x21+x13+x3Q<=5;
x41+x13+x32+x2Q<=5;
x43+x31+x12+x2Q<=5;
x42+x23+x31+x1Q<=5;
x43+x32+x21+x1Q<=5;
x45+x52+x23+x3Q<=5;
x42+x25+x53+x3Q<=5;
x45+x53+x32+x2Q<=5;
x43+x35+x52+x2Q<=5;
x43+x32+x25+x5Q<=5;
x42+x23+x35+x5Q<=5;
x43+x31+x15+x5Q<=5;
x41+x13+x35+x5Q<=5;
x43+x35+x51+x1Q<=5;
x45+x53+x31+x1Q<=5;
x45+x51+x13+x3Q<=5;
x41+x15+x53+x3Q<=5;
x51+x12+x23+x3Q<=5;
x52+x21+x13+x3Q<=5;
x51+x13+x32+x2Q<=5;
x53+x31+x12+x2Q<=5;
x52+x23+x31+x1Q<=5;
x53+x32+x21+x1Q<=5;
x52+x23+x34+x4Q<=5;
x53+x32+x24+x4Q<=5;
x52+x24+x43+x3Q<=5;
x54+x42+x23+x3Q<=5;
x53+x34+x42+x2Q<=5;
x54+x43+x32+x2Q<=5;
x53+x31+x14+x4Q<=5;
x51+x13+x34+x4Q<=5;
x53+x34+x41+x1Q<=5;
x54+x43+x31+x1Q<=5;
x51+x14+x43+x3Q<=5;
x54+x41+x13+x3Q<=5;
x54+x41+x12+x2Q<=5;
x51+x14+x42+x2Q<=5;
x54+x42+x21+x1Q<=5;
x52+x24+x41+x1Q<=5;
x52+x21+x14+x4Q<=5;
x51+x12+x24+x4Q<=5;


/*windows*/
0<= s1;
s1 <=0;

18<= s2;
s2 <= 34;

8<= s3;
s3 <=24;

5<= s4;
s4 <=19;

18<= s5;
s5 <=33;

0 <= sP;
sP <= 0;

35 <= sQ;
sQ <= 35;

/**************************************
* Qij= tsi+tdij
*
* si + Qij + ci - sj <= M(1 - xij)*
*
* sj - Qij - si + ci + M (xij - 1)<=wij
***************************************/

s1 + 6 + c1 - s2 <= 100 - 100 x12;
s1 + 9 + c1 - s3 <= 100 - 100 x13;
s1 + 3 + c1 - s4 <= 100 - 100 x14;
s1 + 4 + c1 - s5 <= 100 - 100 x15;
s1 + 1 + c1 - sQ <= 100 - 100 x1Q;

s2 - 6 - s1 + c1 + 100 x12 - 100 <= w12;
s3 - 9 - s1 + c1 + 100 x13 - 100 <= w13;
s4 - 3 - s1 + c1 + 100 x14 - 100 <= w14;
s5 - 4 - s1 + c1 + 100 x15 - 100 <= w15;

s2 + 9  + c2  - s1<= 100 - 100 x21;
s2 + 12 + c2  - s3<= 100 - 100 x23;
s2 + 7  + c2  - s4<= 100 - 100 x24;
s2 + 6  + c2  - s5<= 100 - 100 x25;
s2 + 1  + c2  - sQ<= 100 - 100 x2Q;

s1 - 9  - s2 + c2 + 100 x21 - 100 <= w21;
s3 - 12 - s2 + c2 + 100 x23 - 100 <= w23;
s4 - 7  - s2 + c2 + 100 x24 - 100 <= w24;
s5 - 6  - s2 + c2 + 100 x25 - 100 <= w25;

s3 + 10  + c3 - s1<= 100 - 100 x31;
s3 + 10  + c3 - s2<= 100 - 100 x32;
s3 + 5   + c3 - s4<= 100 - 100 x34;
s3 + 8   + c3 - s5<= 100 - 100 x35;
s3 + 1   + c3 - sQ<= 100 - 100 x3Q;

s1 - 10 - s3 + c3 + 100 x31 - 100 <= w31;
s2 - 10 - s3 + c3 + 100 x32 - 100 <= w32;
s4 - 5  - s3 + c3 + 100 x34 - 100 <= w34;
s5 - 8  - s3 + c3 + 100 x35 - 100 <= w35;

s4 + 8  + c4  - s1<= 100 - 100 x41;
s4 + 9  + c4  - s2<= 100 - 100 x42;
s4 + 9  + c4  - s3<= 100 - 100 x43;
s4 + 10 + c4  - s5<= 100 - 100 x45;
s4 + 1  + c4  - sQ<= 100 - 100 x4Q;

s1 - 8  - s4 + c4 + 100 x41 - 100 <= w41;
s2 - 9  - s4 + c4 + 100 x42 - 100 <= w42;
s3 - 9  - s4 + c4 + 100 x43 - 100 <= w43;
s5 - 10 - s4 + c4 + 100 x45 - 100 <= w45;

s5 + 5  + c5  - s1<= 100 - 100 x51;
s5 + 4  + c5  - s2<= 100 - 100 x52;
s5 + 8  + c5  - s3<= 100 - 100 x53;
s5 + 6  + c5  - s4<= 100 - 100 x54;
s5 + 1  + c5  - sQ<= 100 - 100 x5Q;

s1 - 5  - s5 + c5 + 100 x51 - 100 <= w51;
s2 - 4  - s5 + c5 + 100 x52 - 100 <= w52;
s3 - 8  - s5 + c5 + 100 x53 - 100 <= w53;
s4 - 6  - s5 + c5 + 100 x54 - 100 <= w54;

/*set binary vars*/
binary x12, x13, x14, x15, x1Q, 
        x21, x23, x24, x25, x2Q,
        x31, x32, x34, x35, x3Q,
        x41, x42, x43, x45, x4Q,
        x51, x52, x53, x54, x5Q,
        xP1, xP2, xP3, xP4, xPQ;

